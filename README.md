## 汽车维修管理系统SQL表

建表语句查看`AutoCreateConsole.sql`，数据查看`AutoSqlData.sql`。

### 账号登录表

| 登录账号 | 登录密码 | 账号类别 | 用户名 | 用户头像 | 用户邮箱 | 用户手机号 | 创建时间 | 更改时间 |
| -------- | -------- | -------- | ------ | -------- | -------- | ---------- | -------- | -------- |
|          |          |          |        |          |          |            |          |          |

账号类别（0/管理员、1/前台、2/机修工、3/焊工、4/漆工、5/业务员、6/客户）

### 客户个人信息表

| 客户编号 | 客户名称（实名） | 客户性质（个人/单位） | 折扣率 | 业务联系人 | 业务联系电话 | 登录账号 |
| -------- | ---------------- | --------------------- | ------ | ---------- | ------------ | -------- |
|          |                  |                       |        |            |              |          |

### 车辆信息

车型代号对应表

| 车型         | 代号 |
| ------------ | ---- |
| SUV          | 0    |
| Bus          | 1    |
| Family Sedan | 2    |
| Fire Engine  | 3    |
| Heavy Truck  | 4    |
| Jeep         | 5    |
| Minibus      | 6    |
| Racing Car   | 7    |
| Taxi         | 8    |
| Truck        | 9    |

| 车牌号 | 车型 | 车架号 | 颜色 | 所属客户（编号） | 创建时间 | 修改时间 |
| ------ | ---- | ------ | ---- | ---------------- | -------- | -------- |
|        |      |        |      |                  |          |          |

### 维修厂员工表

| 员工编号 | 登录账号 | 员工姓名（实名） | 员工工种 |
| -------- | -------- | ---------------- | -------- |
|          |          |                  |          |

- 维修厂员工/客户的个人信息修改都会导致账号登录表的更改时间的重新更新。


- 员工工种与账号类别一致


### 车辆的故障信息表

| 故障单id | 维修类型 | 作业分类 | 结算方式 | 受维修车架号 | 创建时间 | 修改时间 | 维修状态 | 是否支付 |
| -------- | -------- | -------- | -------- | ------------ | -------- | -------- | -------- | -------- |
|          |          |          |          |              |          |          |          |          |

维修状态为0代表维修未完成，1代表已完成。是否支付为0代表未支付，为1代表已支付。

### 客户账单表 （==新增表==）

| 账单id | 客户id | 故障单id | 支付时折扣率 | 付款方式 | 支付金额 | 支付时间 |
| ------ | ------ | -------- | ------------ | -------- | -------- | -------- |
|        |        |          |              |          |          |          |

### 维修委托书

| 委托书id | 客户编号 | 故障单id | 业务员员工编号 | 行驶里程 | 随车物品 | 检查结果 | 维修方案 | 是否洗车 | 维修总费用 | 旧件是否带回 | 创建时间 | 修改时间 | 预计交付时间 |
| -------- | -------- | -------- | -------------- | -------- | -------- | -------- | -------- | -------- | ---------- | ------------ | -------- | -------- | ------------ |
|          |          |          |                |          |          |          |          |          |            |              |          |          |              |

[==4/29已实现==]维修总费用随着委托书下属的维修任务完成而递增

### 维修委托内容（维修项目）

| 维修项目编号 | 委托书id | 维修项目 | 所需零件 | 零件单价 | 零件总金额 | 创建时间 | 修改时间 | 是否完成 |
| ------------ | -------- | -------- | -------- | -------- | ---------- | -------- | -------- | -------- |
|              |          |          |          |          |            |          |          |          |

### 维修派工单

| 维修派工单id | 维修项目编号 | 工时 | 工时单价 | 维修员编号 | 维修员工种 | 是否完成 | 创建时间 | 修改时间 |
| ------------ | ------------ | ---- | -------- | ---------- | ---------- | -------- | -------- | -------- |
|              |              |      |          |            |            |          |          |          |

维修委托任务与维修派工单之间是一对多的关系

### 任务进行记录及历史记录

任务进行情况中0代表未受理，1代表已受理，2代表已拒绝，3代表已完成，4代表中断受理

| 任务进行id | 维修派工单id | 任务分配者id（是否主动寻找） | 任务目标者id | 任务进行情况 | 创建时间 | 终止时间 |
| ---------- | ------------ | ---------------------------- | ------------ | ------------ | -------- | -------- |
|            |              |                              |              |              |          |          |

[==4/28已实现==] 为了做的再细化一点，引入分配任务的机制，员工可以查询到自己接手过的任务的历史记录。任务的状态包括未受理，已受理，已拒绝，已完成，中断受理（error）几种状态。

[==4/28已实现==]（想做的：经理可以强制更改此时的任务分配）

[==4/29已实现==] 使用SQL触发器保证了完成的维修小任务无法继续派发派工单以及完成的车辆故障无法继续布置维修任务。

### 前端添加维修任务思路实现

第一步：有一个表格展示VehicleFault的信息

第二步：点击一个VehicleFault信息后，跳转到一个新的页面，此前端页面采用树型组件，列出如下的信息：（调用queryRepairProgress接口）

- 车辆故障维修状态

- 维修委托书（是/否） [添加按钮]

- 车间生成维修任务数（num）；已完成任务数（num）[添加任务按钮]

  - 维修任务1（是否完成）[添加派工单按钮]

    - 派工单1（是否完成）

      目前与派工单对应的任务进度表

      - misson A（状态）
      - misson B（状态）
      - ...

    - 派工单2（是否完成）

    - ...

  - 维修任务2

  - 维修任务3

  - ...

### 维修进度查询思路

运用Timeline时间线组件

总体流程骨架：（调用queryRepairProgress接口）

维修进行中/已完成

- 生成维修委托书（是/否）

- 车间生成维修任务数（num）；已完成任务数（num）

  - 维修任务1（是否完成）

    - 派工单1（是否完成）

      目前与派工单对应的任务进度表

      - misson A（状态）
      - misson B（状态）
      - ...

    - 派工单2（是否完成）

    - ...

  - 维修任务2

  - 维修任务3

  - ...

- 前台/经理审核确定维修结束

- 等待支付维修费用

- 等待提车

- 维修流程结束√

